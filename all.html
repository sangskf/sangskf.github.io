<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  è§è¯¾å°±ä¸Šçš„å°å©Šç ¸
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="è§è¯¾å°±ä¸Šçš„å°å©Šç ¸" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link rel="icon" href="favicon.ico" type="images/x-ico">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:books.sangkf.cn ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">é¦–é¡µ</a></li>
        
        <li id=""><a target="_self" href="front.html">å‰ç«¯</a></li>
        
        <li id=""><a target="_self" href="java.html">åç«¯</a></li>
        
        <li id=""><a target="_self" href="microservice.html">å¾®æœåŠ¡</a></li>
        
        <li id=""><a target="_self" href="database.html">æ•°æ®åº“</a></li>
        
        <li id=""><a target="_self" href="other.html">å…¶ä»–</a></li>
        
        <li id=""><a target="_self" href="archives.html">å½’æ¡£</a></li>
        
        <li id=""><a target="_blank" href="https://gitee.com/413198756/events">å…³äºä½œè€…</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="https://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="æœç´¢"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; è§è¯¾å°±ä¸Šçš„å°å©Šç ¸</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">é¦–é¡µ</a></li>
        
        <li><a target="_self" href="front.html">å‰ç«¯</a></li>
        
        <li><a target="_self" href="java.html">åç«¯</a></li>
        
        <li><a target="_self" href="microservice.html">å¾®æœåŠ¡</a></li>
        
        <li><a target="_self" href="database.html">æ•°æ®åº“</a></li>
        
        <li><a target="_self" href="other.html">å…¶ä»–</a></li>
        
        <li><a target="_self" href="archives.html">å½’æ¡£</a></li>
        
        <li><a target="_blank" href="https://gitee.com/413198756/events">å…³äºä½œè€…</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="front.html">å‰ç«¯</a></li>
        
            <li><a href="java.html">åç«¯</a></li>
        
            <li><a href="microservice.html">å¾®æœåŠ¡</a></li>
        
            <li><a href="database.html">æ•°æ®åº“</a></li>
        
            <li><a href="other.html">å…¶ä»–</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="15512563500691.html">
                
                  <h1>HashMapæºç è§£è¯»(JDK1.7)</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>å“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰ä¹Ÿå«æ•£åˆ—è¡¨ï¼Œæ˜¯ä¸€ç§éå¸¸é‡è¦çš„æ•°æ®ç»“æ„ï¼Œåº”ç”¨åœºæ™¯åŠå…¶ä¸°å¯Œï¼Œè®¸å¤šç¼“å­˜æŠ€æœ¯ï¼ˆæ¯”å¦‚memcachedï¼‰çš„æ ¸å¿ƒå…¶å®å°±æ˜¯åœ¨å†…å­˜ä¸­ç»´æŠ¤ä¸€å¼ å¤§çš„å“ˆå¸Œè¡¨ï¼Œè€ŒHashMapçš„å®ç°åŸç†ä¹Ÿå¸¸å¸¸å‡ºç°åœ¨å„ç±»çš„é¢è¯•é¢˜ä¸­ï¼Œé‡è¦æ€§å¯è§ä¸€æ–‘ã€‚æœ¬æ–‡ä¼šå¯¹javaé›†åˆæ¡†æ¶ä¸­çš„å¯¹åº”å®ç°HashMapçš„å®ç°åŸç†è¿›è¡Œè®²è§£ï¼Œç„¶åä¼šå¯¹JDK7çš„HashMapæºç è¿›è¡Œåˆ†æã€‚<br/>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                   <a href="15512563500691.html">é˜…è¯»æ›´å¤š&gt;&gt;</a>&nbsp;&nbsp; 
                    <span class="date">2019/2/27 16:32 ä¸‹åˆ</span>
                    <span>å‘å¸ƒäºåˆ†ç±»&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='java.html'>åç«¯</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15512560778974.html">
                
                  <h1>HashMapæºç è§£è¯»(JDK1.8)</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h2 id="toc_0">æ¦‚è¿°</h2>

<p>åœ¨JDK1.8ä¹‹å‰ï¼ŒHashMapé‡‡ç”¨<code>æ•°ç»„+é“¾è¡¨</code>å®ç°ï¼Œå³ä½¿ç”¨é“¾è¡¨å¤„ç†å†²çªï¼ŒåŒä¸€hashå€¼çš„èŠ‚ç‚¹éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªé“¾è¡¨é‡Œã€‚ä½†æ˜¯å½“ä½äºä¸€ä¸ªæ¡¶ä¸­çš„å…ƒç´ è¾ƒå¤šï¼Œå³hashå€¼ç›¸ç­‰çš„å…ƒç´ è¾ƒå¤šæ—¶ï¼Œé€šè¿‡keyå€¼ä¾æ¬¡æŸ¥æ‰¾çš„æ•ˆç‡è¾ƒä½ã€‚è€ŒJDK1.8ä¸­ï¼ŒHashMapé‡‡ç”¨<code>æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘</code>å®ç°ï¼Œå½“é“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼ï¼ˆ8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ ·å¤§å¤§å‡å°‘äº†æŸ¥æ‰¾æ—¶é—´ã€‚</p>

<p>ä¸‹å›¾ä¸­ä»£è¡¨jdk1.8ä¹‹å‰çš„hashmapç»“æ„ï¼Œå·¦è¾¹éƒ¨åˆ†å³ä»£è¡¨å“ˆå¸Œè¡¨ï¼Œä¹Ÿç§°ä¸ºå“ˆå¸Œæ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œé“¾è¡¨æ˜¯ç”¨æ¥è§£å†³å†²çªçš„ï¼Œå¦‚æœä¸åŒçš„keyæ˜ å°„åˆ°äº†æ•°ç»„çš„åŒä¸€ä½ç½®å¤„ï¼Œå°±å°†å…¶æ”¾å…¥å•é“¾è¡¨ä¸­ã€‚</p>

<p><img src="media/15512560778974/249993-20170725101800296-127995101.png" alt="" class="mw_img_center" style="width:500px;display: block; clear:both; margin: 0 auto;"/></p>

<p>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â  jdk1.8ä¹‹å‰hashmapç»“æ„å›¾</p>

<p>Â Â Â Â  jdk1.8ä¹‹å‰çš„hashmapéƒ½é‡‡ç”¨ä¸Šå›¾çš„ç»“æ„ï¼Œéƒ½æ˜¯åŸºäºä¸€ä¸ªæ•°ç»„å’Œå¤šä¸ªå•é“¾è¡¨ï¼Œhashå€¼å†²çªçš„æ—¶å€™ï¼Œå°±å°†å¯¹åº”èŠ‚ç‚¹ä»¥é“¾è¡¨çš„å½¢å¼å­˜å‚¨ã€‚å¦‚æœåœ¨ä¸€ä¸ªé“¾è¡¨ä¸­æŸ¥æ‰¾å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œå°†ä¼šèŠ±è´¹Oï¼ˆnï¼‰çš„æŸ¥æ‰¾æ—¶é—´ï¼Œä¼šæœ‰å¾ˆå¤§çš„æ€§èƒ½æŸå¤±ã€‚åˆ°äº†jdk1.8ï¼Œå½“åŒä¸€ä¸ªhashå€¼çš„èŠ‚ç‚¹æ•°ä¸å°äº8æ—¶ï¼Œä¸å†é‡‡ç”¨å•é“¾è¡¨å½¢å¼å­˜å‚¨ï¼Œè€Œæ˜¯é‡‡ç”¨çº¢é»‘æ ‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>

<p><img src="media/15512560778974/249993-20170725102326906-1051203702.png" alt="" style="width:300px;"/></p>

<p><img src="media/15512560778974/249993-20170725102510515-1481424113.png" alt="" style="width:500px;"/><br/>
                jdk1.8 hashmapç»“æ„å›¾</p>

<p>è¯´æ˜ï¼šä¸Šå›¾å¾ˆå½¢è±¡çš„å±•ç¤ºäº†HashMapçš„æ•°æ®ç»“æ„ï¼ˆæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘ï¼‰ï¼Œæ¡¶ä¸­çš„ç»“æ„å¯èƒ½æ˜¯é“¾è¡¨ï¼Œä¹Ÿå¯èƒ½æ˜¯çº¢é»‘æ ‘ï¼Œçº¢é»‘æ ‘çš„å¼•å…¥æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ã€‚</p>

<h2 id="toc_1">æ¶‰åŠåˆ°çš„æ•°æ®ç»“æ„ï¼šå¤„ç†hashå†²çªçš„é“¾è¡¨å’Œçº¢é»‘æ ‘ä»¥åŠä½æ¡¶</h2>

<h3 id="toc_2">é“¾è¡¨çš„å®ç°</h3>

<p><img src="media/15512560778974/249993-20170725130741693-207764447.png" alt="" style="width:400px;"/></p>

<p>Nodeæ˜¯HashMapçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ç°äº†Map.Entryæ¥å£ï¼Œæœ¬è´¨æ˜¯å°±æ˜¯ä¸€ä¸ªæ˜ å°„(é”®å€¼å¯¹)ã€‚ä¸Šå›¾ä¸­çš„æ¯ä¸ªé»‘è‰²åœ†ç‚¹å°±æ˜¯ä¸€ä¸ªNodeå¯¹è±¡ã€‚æ¥çœ‹å…·ä½“ä»£ç ï¼š</p>

<pre><code class="language-java">//Nodeæ˜¯å•å‘é“¾è¡¨ï¼Œå®ƒå®ç°äº†Map.Entryæ¥å£
static class Node implements Map.Entry { final int hash; final K key;
    V value;
    Node next; //æ„é€ å‡½æ•°Hashå€¼ é”® å€¼ ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    Node(int hash, K key, V value, Node next) { this.hash = hash; this.key = key; this.value = value; this.next = next;
    } public final K getKey()        { return key; } public final V getValue()      { return value; } public final String toString() { return key + = + value; } public final int hashCode() { return Objects.hashCode(key) ^ Objects.hashCode(value);
    } public final V setValue(V newValue) {
        V oldValue = value;
        value = newValue; return oldValue;
    } //åˆ¤æ–­ä¸¤ä¸ªnodeæ˜¯å¦ç›¸ç­‰,è‹¥keyå’Œvalueéƒ½ç›¸ç­‰ï¼Œè¿”å›trueã€‚å¯ä»¥ä¸è‡ªèº«æ¯”è¾ƒä¸ºtrue
    public final boolean equals(Object o) { if (o == this) return true; if (o instanceof Map.Entry) {
            Map.Entry e = (Map.Entry)o; if (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue())) return true;
        } return false;
    }
}
</code></pre>

<p>å¯ä»¥çœ‹åˆ°ï¼Œnodeä¸­åŒ…å«ä¸€ä¸ªnextå˜é‡ï¼Œè¿™ä¸ªå°±æ˜¯é“¾è¡¨çš„å…³é”®ç‚¹ï¼Œhashç»“æœç›¸åŒçš„å…ƒç´ å°±æ˜¯é€šè¿‡è¿™ä¸ªnextè¿›è¡Œå…³è”çš„ã€‚</p>

<h3 id="toc_3">çº¢é»‘æ ‘</h3>

<pre><code class="language-java">//çº¢é»‘æ ‘
static final class TreeNode extends LinkedHashMap.Entry {
    TreeNode parent;  // çˆ¶èŠ‚ç‚¹
    TreeNode left; //å·¦å­æ ‘
    TreeNode right;//å³å­æ ‘
    TreeNode prev;    // needed to unlink next upon deletion
    boolean red;    //é¢œè‰²å±æ€§
    TreeNode(int hash, K key, V val, Node next) { super(hash, key, val, next);
    } //è¿”å›å½“å‰èŠ‚ç‚¹çš„æ ¹èŠ‚ç‚¹
    final TreeNode root() { for (TreeNode r = this, p;;) { if ((p = r.parent) == null) return r;
            r = p;
        }
    }
}
</code></pre>

<p>çº¢é»‘æ ‘æ¯”é“¾è¡¨å¤šäº†å››ä¸ªå˜é‡ï¼Œparentçˆ¶èŠ‚ç‚¹ã€leftå·¦èŠ‚ç‚¹ã€rightå³èŠ‚ç‚¹ã€prevä¸Šä¸€ä¸ªåŒçº§èŠ‚ç‚¹ï¼Œçº¢é»‘æ ‘å†…å®¹è¾ƒå¤šï¼Œä¸åœ¨èµ˜è¿°ã€‚</p>

<h3 id="toc_4">ä½æ¡¶</h3>

<pre><code class="language-java">transient Node[] table;//å­˜å‚¨ï¼ˆä½æ¡¶ï¼‰çš„æ•°ç»„
</code></pre>

<p>HashMapç±»ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å­—æ®µï¼Œå°±æ˜¯ Node[] tableï¼Œå³å“ˆå¸Œæ¡¶æ•°ç»„ï¼Œæ˜æ˜¾å®ƒæ˜¯ä¸€ä¸ªNodeçš„æ•°ç»„ã€‚</p>

<p>Â Â Â Â  æœ‰äº†ä»¥ä¸Š3ä¸ªæ•°æ®ç»“æ„ï¼Œåªè¦æœ‰ä¸€ç‚¹æ•°æ®ç»“æ„åŸºç¡€çš„äººï¼Œéƒ½å¯ä»¥å¤§è‡´è”æƒ³åˆ°HashMapçš„å®ç°äº†ã€‚é¦–å…ˆæœ‰ä¸€ä¸ªæ¯ä¸ªå…ƒç´ éƒ½æ˜¯é“¾è¡¨ï¼ˆå¯èƒ½è¡¨è¿°ä¸å‡†ç¡®ï¼‰çš„æ•°ç»„ï¼Œå½“æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼ˆkey-valueï¼‰æ—¶ï¼Œå°±é¦–å…ˆè®¡ç®—å…ƒç´ keyçš„hashå€¼ï¼Œä»¥æ­¤ç¡®å®šæ’å…¥æ•°ç»„ä¸­çš„ä½ç½®ï¼Œä½†æ˜¯å¯èƒ½å­˜åœ¨åŒä¸€hashå€¼çš„å…ƒç´ å·²ç»è¢«æ”¾åœ¨æ•°ç»„åŒä¸€ä½ç½®äº†ï¼Œè¿™æ—¶å°±æ·»åŠ åˆ°åŒä¸€hashå€¼çš„å…ƒç´ çš„åé¢ï¼Œä»–ä»¬åœ¨æ•°ç»„çš„åŒä¸€ä½ç½®ï¼Œä½†æ˜¯å½¢æˆäº†é“¾è¡¨ï¼Œæ‰€ä»¥è¯´æ•°ç»„å­˜æ”¾çš„æ˜¯é“¾è¡¨ã€‚è€Œå½“é“¾è¡¨é•¿åº¦å¤ªé•¿æ—¶ï¼Œé“¾è¡¨å°±è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ ·å¤§å¤§æé«˜äº†æŸ¥æ‰¾çš„æ•ˆç‡ã€‚</p>

<h2 id="toc_5">HashMapæºç åˆ†æ</h2>

<h3 id="toc_6">ç±»çš„ç»§æ‰¿å…³ç³»</h3>

<pre><code class="language-java">public class HashMap extends AbstractMap implements Map, Cloneable, Serializable
</code></pre>

<p>Â Â Â Â  å¯ä»¥çœ‹åˆ°HashMapç»§æ‰¿è‡ªçˆ¶ç±»ï¼ˆAbstractMapï¼‰ï¼Œå®ç°äº†Mapã€Cloneableã€Serializableæ¥å£ã€‚å…¶ä¸­ï¼ŒMapæ¥å£å®šä¹‰äº†ä¸€ç»„é€šç”¨çš„æ“ä½œï¼›Cloneableæ¥å£åˆ™è¡¨ç¤ºå¯ä»¥è¿›è¡Œæ‹·è´ï¼Œåœ¨HashMapä¸­ï¼Œå®ç°çš„æ˜¯æµ…å±‚æ¬¡æ‹·è´ï¼Œå³å¯¹æ‹·è´å¯¹è±¡çš„æ”¹å˜ä¼šå½±å“è¢«æ‹·è´çš„å¯¹è±¡ï¼›Serializableæ¥å£è¡¨ç¤ºHashMapå®ç°äº†åºåˆ—åŒ–ï¼Œå³å¯ä»¥å°†HashMapå¯¹è±¡ä¿å­˜è‡³æœ¬åœ°ï¼Œä¹‹åå¯ä»¥æ¢å¤çŠ¶æ€ã€‚</p>

<h3 id="toc_7">ç±»çš„å±æ€§</h3>

<pre><code class="language-java">public class HashMap extends AbstractMap implements Map, Cloneable, Serializable { // åºåˆ—å·
    private static final long serialVersionUID = 362498820763181265L; // é»˜è®¤çš„åˆå§‹å®¹é‡æ˜¯16
    static final int DEFAULT_INITIAL_CAPACITY = 1 ; // æœ€å¤§å®¹é‡
    static final int MAXIMUM_CAPACITY = 1 ; // é»˜è®¤çš„å¡«å……å› å­
    static final float DEFAULT_LOAD_FACTOR = 0.75f; // å½“æ¡¶(bucket)ä¸Šçš„ç»“ç‚¹æ•°å¤§äºè¿™ä¸ªå€¼æ—¶ä¼šè½¬æˆçº¢é»‘æ ‘
    static final int TREEIFY_THRESHOLD = 8; // å½“æ¡¶(bucket)ä¸Šçš„ç»“ç‚¹æ•°å°äºè¿™ä¸ªå€¼æ—¶æ ‘è½¬é“¾è¡¨
    static final int UNTREEIFY_THRESHOLD = 6; // æ¡¶ä¸­ç»“æ„è½¬åŒ–ä¸ºçº¢é»‘æ ‘å¯¹åº”çš„tableçš„æœ€å°å¤§å°
    static final int MIN_TREEIFY_CAPACITY = 64; // å­˜å‚¨å…ƒç´ çš„æ•°ç»„ï¼Œæ€»æ˜¯2çš„å¹‚æ¬¡å€
    transient Node[] table; // å­˜æ”¾å…·ä½“å…ƒç´ çš„é›†
    transient Set&gt; entrySet; // å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼Œæ³¨æ„è¿™ä¸ªä¸ç­‰äºæ•°ç»„çš„é•¿åº¦ã€‚
    transient int size; // æ¯æ¬¡æ‰©å®¹å’Œæ›´æ”¹mapç»“æ„çš„è®¡æ•°å™¨
    transient int modCount; // ä¸´ç•Œå€¼ å½“å®é™…å¤§å°(å®¹é‡*å¡«å……å› å­)è¶…è¿‡ä¸´ç•Œå€¼æ—¶ï¼Œä¼šè¿›è¡Œæ‰©å®¹
    int threshold; // å¡«å……å› å­
    final float loadFactor;
}
</code></pre>

<p>è¯´æ˜ï¼šç±»çš„æ•°æ®æˆå‘˜å¾ˆé‡è¦ï¼Œä»¥ä¸Šä¹Ÿè§£é‡Šå¾—å¾ˆè¯¦ç»†äº†ã€‚</p>

<h3 id="toc_8">ç±»çš„æ„é€ å‡½æ•°</h3>

<h4 id="toc_9">HashMap(int, float)å‹æ„é€ å‡½æ•°</h4>

<pre><code class="language-java">public HashMap(int initialCapacity, float loadFactor) { // åˆå§‹å®¹é‡ä¸èƒ½å°äº0ï¼Œå¦åˆ™æŠ¥é”™
    if (initialCapacity ) throw new IllegalArgumentException(&quot;Illegal initial capacity: &quot; + initialCapacity); // åˆå§‹å®¹é‡ä¸èƒ½å¤§äºæœ€å¤§å€¼ï¼Œå¦åˆ™ä¸ºæœ€å¤§å€¼
    if (initialCapacity &gt; MAXIMUM_CAPACITY)
        initialCapacity = MAXIMUM_CAPACITY; // å¡«å……å› å­ä¸èƒ½å°äºæˆ–ç­‰äº0ï¼Œä¸èƒ½ä¸ºéæ•°å­—
    if (loadFactor Float.isNaN(loadFactor)) throw new IllegalArgumentException(&quot;Illegal load factor: &quot; + loadFactor); // åˆå§‹åŒ–å¡«å……å› å­ 
    this.loadFactor = loadFactor; // åˆå§‹åŒ–thresholdå¤§å°
    this.threshold = tableSizeFor(initialCapacity);    
}
</code></pre>

<p>è¯´æ˜ï¼štableSizeFor(initialCapacity)è¿”å›å¤§äºinitialCapacityçš„æœ€å°çš„äºŒæ¬¡å¹‚æ•°å€¼ã€‚</p>

<pre><code class="language-java">static final int tableSizeFor(int cap) { int n = cap - 1;
    n |= n &gt;&gt;&gt; 1;
    n |= n &gt;&gt;&gt; 2;
    n |= n &gt;&gt;&gt; 4;
    n |= n &gt;&gt;&gt; 8;
    n |= n &gt;&gt;&gt; 16; return (n = MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;
}
</code></pre>

<p>è¯´æ˜ï¼š&gt;&gt;&gt; æ“ä½œç¬¦è¡¨ç¤ºæ— ç¬¦å·å³ç§»ï¼Œé«˜ä½å–0ã€‚</p>

<h4 id="toc_10">HashMap(int)å‹æ„é€ å‡½æ•°</h4>

<pre><code class="language-java">public HashMap(int initialCapacity) { // è°ƒç”¨HashMap(int, float)å‹æ„é€ å‡½æ•°
    this(initialCapacity, DEFAULT_LOAD_FACTOR);
}
</code></pre>

<h4 id="toc_11">HashMap()å‹æ„é€ å‡½æ•°</h4>

<pre><code class="language-java">public HashMap() { // åˆå§‹åŒ–å¡«å……å› å­
    this.loadFactor = DEFAULT_LOAD_FACTOR; 
}
</code></pre>

<h4 id="toc_12">HashMap(Map)å‹æ„é€ å‡½æ•°</h4>

<pre><code class="language-java">public HashMap(Mapextends K, ? extends V&gt; m) { // åˆå§‹åŒ–å¡«å……å› å­
    this.loadFactor = DEFAULT_LOAD_FACTOR; // å°†mä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ è‡³HashMapä¸­
    putMapEntries(m, false);
}
</code></pre>

<p>è¯´æ˜ï¼šputMapEntries(Map m, boolean evict)å‡½æ•°å°†mçš„æ‰€æœ‰å…ƒç´ å­˜å…¥æœ¬HashMapå®ä¾‹ä¸­ã€‚ã€€</p>

<pre><code class="language-java">final void putMapEntries(Mapextends K, ? extends V&gt; m, boolean evict) { int s = m.size(); if (s &gt; 0) { // åˆ¤æ–­tableæ˜¯å¦å·²ç»åˆå§‹åŒ–
        if (table == null) { // pre-size // æœªåˆå§‹åŒ–ï¼Œsä¸ºmçš„å®é™…å…ƒç´ ä¸ªæ•°
            float ft = ((float)s / loadFactor) + 1.0F; int t = ((ft float)MAXIMUM_CAPACITY) ? (int)ft : MAXIMUM_CAPACITY); // è®¡ç®—å¾—åˆ°çš„tå¤§äºé˜ˆå€¼ï¼Œåˆ™åˆå§‹åŒ–é˜ˆå€¼
            if (t &gt; threshold)
                threshold = tableSizeFor(t);
        } // å·²åˆå§‹åŒ–ï¼Œå¹¶ä¸”må…ƒç´ ä¸ªæ•°å¤§äºé˜ˆå€¼ï¼Œè¿›è¡Œæ‰©å®¹å¤„ç†
        else if (s &gt; threshold)
            resize(); // å°†mä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ è‡³HashMapä¸­
        for (Map.Entryextends K, ? extends V&gt; e : m.entrySet()) {
            K key = e.getKey();
            V value = e.getValue();
            putVal(hash(key), key, value, false, evict);
        }
    }
}
</code></pre>

<h3 id="toc_13">hashç®—æ³•</h3>

<p>åœ¨JDK 1.8ä¸­ï¼Œhashæ–¹æ³•å¦‚ä¸‹ï¼š</p>

<pre><code class="language-java">static final int hash(Object key) { int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);
}
</code></pre>

<p>ï¼ˆ1ï¼‰é¦–å…ˆè·å–å¯¹è±¡çš„hashCode()å€¼ï¼Œç„¶åå°†hashCodeå€¼å³ç§»16ä½ï¼Œç„¶åå°†å³ç§»åçš„å€¼ä¸åŸæ¥çš„hashCodeåš<strong>å¼‚æˆ–</strong>è¿ç®—ï¼Œè¿”å›ç»“æœã€‚ï¼ˆå…¶ä¸­h&gt;&gt;&gt;16ï¼Œåœ¨JDK1.8ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œä½¿ç”¨äº†é›¶æ‰©å±•ï¼Œæ— è®ºæ­£æ•°è¿˜æ˜¯è´Ÿæ•°ï¼Œéƒ½åœ¨é«˜ä½æ’å…¥0ï¼‰ã€‚</p>

<p>ï¼ˆ2ï¼‰åœ¨putValæºç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡(n-1)&amp;hashè·å–è¯¥å¯¹è±¡çš„é”®åœ¨hashmapä¸­çš„ä½ç½®ã€‚ï¼ˆå…¶ä¸­hashçš„å€¼å°±æ˜¯ï¼ˆ1ï¼‰ä¸­è·å¾—çš„å€¼ï¼‰å…¶ä¸­nè¡¨ç¤ºçš„æ˜¯hashæ¡¶æ•°ç»„çš„é•¿åº¦ï¼Œå¹¶ä¸”è¯¥é•¿åº¦ä¸º2çš„næ¬¡æ–¹ï¼Œè¿™æ ·(n-1)&amp;hashå°±ç­‰ä»·äºhash%nã€‚å› ä¸º&amp;è¿ç®—çš„æ•ˆç‡é«˜äº%è¿ç®—ã€‚</p>

<pre><code class="language-java">final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) {
    ... 
    if ((p = tab[i = (n - 1) &amp; hash]) == null)//è·å–ä½ç½®
        tab[i] = newNode(hash, key, value, null);
    ...
}
</code></pre>

<p>Â Â Â Â Â  tabå³æ˜¯tableï¼Œnæ˜¯mapé›†åˆçš„å®¹é‡å¤§å°ï¼Œhashæ˜¯ä¸Šé¢æ–¹æ³•çš„è¿”å›å€¼ã€‚å› ä¸ºé€šå¸¸å£°æ˜mapé›†åˆæ—¶ä¸ä¼šæŒ‡å®šå¤§å°ï¼Œæˆ–è€…åˆå§‹åŒ–çš„æ—¶å€™å°±åˆ›å»ºä¸€ä¸ªå®¹é‡å¾ˆå¤§çš„mapå¯¹è±¡ï¼Œæ‰€ä»¥è¿™ä¸ªé€šè¿‡å®¹é‡å¤§å°ä¸keyå€¼è¿›è¡Œhashçš„ç®—æ³•åœ¨å¼€å§‹çš„æ—¶å€™åªä¼šå¯¹ä½ä½è¿›è¡Œè®¡ç®—ï¼Œè™½ç„¶å®¹é‡çš„2è¿›åˆ¶é«˜ä½ä¸€å¼€å§‹éƒ½æ˜¯0ï¼Œä½†æ˜¯keyçš„2è¿›åˆ¶é«˜ä½é€šå¸¸æ˜¯æœ‰å€¼çš„ï¼Œå› æ­¤å…ˆåœ¨hashæ–¹æ³•ä¸­å°†keyçš„hashCodeå³ç§»16ä½åœ¨ä¸è‡ªèº«å¼‚æˆ–ï¼Œä½¿å¾—é«˜ä½ä¹Ÿå¯ä»¥å‚ä¸hashï¼Œæ›´å¤§ç¨‹åº¦ä¸Šå‡å°‘äº†ç¢°æ’ç‡ã€‚</p>

<p>ä¸‹é¢ä¸¾ä¾‹è¯´æ˜ä¸‹ï¼Œnä¸ºtableçš„é•¿åº¦ã€‚</p>

<p><img src="media/15512560778974/249993-20170725154200021-869603681.png" alt="" style="width:500px;"/></p>

<h3 id="toc_14">é‡è¦æ–¹æ³•åˆ†æ</h3>

<p><strong>ï¼ˆ1ï¼‰putValæ–¹æ³•</strong></p>

<p>é¦–å…ˆè¯´æ˜ï¼ŒHashMapå¹¶æ²¡æœ‰ç›´æ¥æä¾›putValæ¥å£ç»™ç”¨æˆ·è°ƒç”¨ï¼Œè€Œæ˜¯æä¾›çš„putæ–¹æ³•ï¼Œè€Œputæ–¹æ³•å°±æ˜¯é€šè¿‡putValæ¥æ’å…¥å…ƒç´ çš„ã€‚</p>

<pre><code class="language-java">public V put(K key, V value) { // å¯¹keyçš„hashCode()åšhash 
    return putVal(hash(key), key, value, false, true);  
} 
</code></pre>

<p>putValæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹å¯ä»¥é€šè¿‡ä¸‹å›¾æ¥ç†è§£ï¼š</p>

<p><img src="media/15512560778974/249993-20170725160254943-1515467235.png" alt="" style="width:700px;"/></p>

<p>â‘ .åˆ¤æ–­é”®å€¼å¯¹æ•°ç»„table[i]æ˜¯å¦ä¸ºç©ºæˆ–ä¸ºnullï¼Œå¦åˆ™æ‰§è¡Œresize()è¿›è¡Œæ‰©å®¹ï¼›</p>

<p>â‘¡.æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼å¾—åˆ°æ’å…¥çš„æ•°ç»„ç´¢å¼•iï¼Œå¦‚æœtable[i]==nullï¼Œç›´æ¥æ–°å»ºèŠ‚ç‚¹æ·»åŠ ï¼Œè½¬å‘â‘¥ï¼Œå¦‚æœtable[i]ä¸ä¸ºç©ºï¼Œè½¬å‘â‘¢ï¼›</p>

<p>â‘¢.åˆ¤æ–­table[i]çš„é¦–ä¸ªå…ƒç´ æ˜¯å¦å’Œkeyä¸€æ ·ï¼Œå¦‚æœç›¸åŒç›´æ¥è¦†ç›–valueï¼Œå¦åˆ™è½¬å‘â‘£ï¼Œè¿™é‡Œçš„ç›¸åŒæŒ‡çš„æ˜¯hashCodeä»¥åŠequalsï¼›</p>

<p>â‘£.åˆ¤æ–­table[i] æ˜¯å¦ä¸ºtreeNodeï¼Œå³table[i] æ˜¯å¦æ˜¯çº¢é»‘æ ‘ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥é”®å€¼å¯¹ï¼Œå¦åˆ™è½¬å‘â‘¤ï¼›</p>

<p>â‘¤.éå†table[i]ï¼Œåˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦å¤§äº8ï¼Œå¤§äº8çš„è¯æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œåœ¨çº¢é»‘æ ‘ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼Œå¦åˆ™è¿›è¡Œé“¾è¡¨çš„æ’å…¥æ“ä½œï¼›éå†è¿‡ç¨‹ä¸­è‹¥å‘ç°keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–valueå³å¯ï¼›</p>

<p>â‘¥.æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡sizeæ˜¯å¦è¶…å¤šäº†æœ€å¤§å®¹é‡thresholdï¼Œå¦‚æœè¶…è¿‡ï¼Œè¿›è¡Œæ‰©å®¹ã€‚</p>

<p>å…·ä½“æºç å¦‚ä¸‹ï¼š</p>

<pre><code class="language-java">final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) {
    Node[] tab; Node p; int n, i; // æ­¥éª¤â‘ ï¼štabä¸ºç©ºåˆ™åˆ›å»º // tableæœªåˆå§‹åŒ–æˆ–è€…é•¿åº¦ä¸º0ï¼Œè¿›è¡Œæ‰©å®¹
    if ((tab = table) == null || (n = tab.length) == 0)
        n = (tab = resize()).length; // æ­¥éª¤â‘¡ï¼šè®¡ç®—indexï¼Œå¹¶å¯¹nullåšå¤„ç† // (n - 1) &amp; hash ç¡®å®šå…ƒç´ å­˜æ”¾åœ¨å“ªä¸ªæ¡¶ä¸­ï¼Œæ¡¶ä¸ºç©ºï¼Œæ–°ç”Ÿæˆç»“ç‚¹æ”¾å…¥æ¡¶ä¸­(æ­¤æ—¶ï¼Œè¿™ä¸ªç»“ç‚¹æ˜¯æ”¾åœ¨æ•°ç»„ä¸­)
    if ((p = tab[i = (n - 1) &amp; hash]) == null)
        tab[i] = newNode(hash, key, value, null); // æ¡¶ä¸­å·²ç»å­˜åœ¨å…ƒç´ 
    else {
        Node e; K k; // æ­¥éª¤â‘¢ï¼šèŠ‚ç‚¹keyå­˜åœ¨ï¼Œç›´æ¥è¦†ç›–value // æ¯”è¾ƒæ¡¶ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ (æ•°ç»„ä¸­çš„ç»“ç‚¹)çš„hashå€¼ç›¸ç­‰ï¼Œkeyç›¸ç­‰
        if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) // å°†ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™eï¼Œç”¨eæ¥è®°å½•
                e = p; // æ­¥éª¤â‘£ï¼šåˆ¤æ–­è¯¥é“¾ä¸ºçº¢é»‘æ ‘ // hashå€¼ä¸ç›¸ç­‰ï¼Œå³keyä¸ç›¸ç­‰ï¼›ä¸ºçº¢é»‘æ ‘ç»“ç‚¹
        else if (p instanceof TreeNode) // æ”¾å…¥æ ‘ä¸­
            e = ((TreeNode)p).putTreeVal(this, tab, hash, key, value); // æ­¥éª¤â‘¤ï¼šè¯¥é“¾ä¸ºé“¾è¡¨ // ä¸ºé“¾è¡¨ç»“ç‚¹
        else { // åœ¨é“¾è¡¨æœ€æœ«æ’å…¥ç»“ç‚¹
            for (int binCount = 0; ; ++binCount) { // åˆ°è¾¾é“¾è¡¨çš„å°¾éƒ¨
                if ((e = p.next) == null) { // åœ¨å°¾éƒ¨æ’å…¥æ–°ç»“ç‚¹
                    p.next = newNode(hash, key, value, null); // ç»“ç‚¹æ•°é‡è¾¾åˆ°é˜ˆå€¼ï¼Œè½¬åŒ–ä¸ºçº¢é»‘æ ‘
                    if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st
 treeifyBin(tab, hash); // è·³å‡ºå¾ªç¯
                    break;
                } // åˆ¤æ–­é“¾è¡¨ä¸­ç»“ç‚¹çš„keyå€¼ä¸æ’å…¥çš„å…ƒç´ çš„keyå€¼æ˜¯å¦ç›¸ç­‰
                if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) // ç›¸ç­‰ï¼Œè·³å‡ºå¾ªç¯
                    break; // ç”¨äºéå†æ¡¶ä¸­çš„é“¾è¡¨ï¼Œä¸å‰é¢çš„e = p.nextç»„åˆï¼Œå¯ä»¥éå†é“¾è¡¨
                p = e;
            }
        } // è¡¨ç¤ºåœ¨æ¡¶ä¸­æ‰¾åˆ°keyå€¼ã€hashå€¼ä¸æ’å…¥å…ƒç´ ç›¸ç­‰çš„ç»“ç‚¹
        if (e != null) { // è®°å½•eçš„value
            V oldValue = e.value; // onlyIfAbsentä¸ºfalseæˆ–è€…æ—§å€¼ä¸ºnull
            if (!onlyIfAbsent || oldValue == null) //ç”¨æ–°å€¼æ›¿æ¢æ—§å€¼
                e.value = value; // è®¿é—®åå›è°ƒ
 afterNodeAccess(e); // è¿”å›æ—§å€¼
            return oldValue;
        }
    } // ç»“æ„æ€§ä¿®æ”¹
    ++modCount; // æ­¥éª¤â‘¥ï¼šè¶…è¿‡æœ€å¤§å®¹é‡ å°±æ‰©å®¹ // å®é™…å¤§å°å¤§äºé˜ˆå€¼åˆ™æ‰©å®¹
    if (++size &gt; threshold)
        resize(); // æ’å…¥åå›è°ƒ
 afterNodeInsertion(evict); return null;
}
</code></pre>

<h5 id="toc_15">HashMapçš„æ•°æ®å­˜å‚¨å®ç°åŸç†</h5>

<p><strong>æµç¨‹ï¼š</strong></p>

<p>1. æ ¹æ®keyè®¡ç®—å¾—åˆ°key.hash = (h = k.hashCode()) ^ (h &gt;&gt;&gt;Â 16)ï¼›</p>

<p>2. æ ¹æ®key.hashè®¡ç®—å¾—åˆ°æ¡¶æ•°ç»„çš„ç´¢å¼•index = key.hash &amp; (table.length -Â 1)ï¼Œè¿™æ ·å°±æ‰¾åˆ°è¯¥keyçš„å­˜æ”¾ä½ç½®äº†ï¼š</p>

<p>â‘  å¦‚æœè¯¥ä½ç½®æ²¡æœ‰æ•°æ®ï¼Œç”¨è¯¥æ•°æ®æ–°ç”Ÿæˆä¸€ä¸ªèŠ‚ç‚¹ä¿å­˜æ–°æ•°æ®ï¼Œè¿”å›nullï¼›</p>

<p>â‘¡ å¦‚æœè¯¥ä½ç½®æœ‰æ•°æ®æ˜¯ä¸€ä¸ªçº¢é»‘æ ‘ï¼Œé‚£ä¹ˆæ‰§è¡Œç›¸åº”çš„æ’å…¥ / æ›´æ–°æ“ä½œï¼›</p>

<p>â‘¢ å¦‚æœè¯¥ä½ç½®æœ‰æ•°æ®æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œåˆ†ä¸¤ç§æƒ…å†µä¸€æ˜¯è¯¥é“¾è¡¨æ²¡æœ‰è¿™ä¸ªèŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªæ˜¯è¯¥é“¾è¡¨ä¸Šæœ‰è¿™ä¸ªèŠ‚ç‚¹ï¼Œæ³¨æ„è¿™é‡Œåˆ¤æ–­çš„ä¾æ®æ˜¯key.hashæ˜¯å¦ä¸€æ ·ï¼š</p>

<p>å¦‚æœè¯¥é“¾è¡¨æ²¡æœ‰è¿™ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆé‡‡ç”¨å°¾æ’æ³•æ–°å¢èŠ‚ç‚¹ä¿å­˜æ–°æ•°æ®ï¼Œè¿”å›nullï¼›å¦‚æœè¯¥é“¾è¡¨å·²ç»æœ‰è¿™ä¸ªèŠ‚ç‚¹äº†ï¼Œé‚£ä¹ˆæ‰¾åˆ°è¯¥èŠ‚ç‚¹å¹¶æ›´æ–°æ–°æ•°æ®ï¼Œè¿”å›è€æ•°æ®ã€‚</p>

<p>æ³¨æ„ï¼š</p>

<p>HashMapçš„putä¼šè¿”å›keyçš„ä¸Šä¸€æ¬¡ä¿å­˜çš„æ•°æ®ï¼Œæ¯”å¦‚ï¼š</p>

<pre><code class="language-java">HashMap map = new HashMap();
System.out.println(map.put(&quot;a&quot;, &quot;A&quot;)); // æ‰“å°null
System.out.println(map.put(&quot;a&quot;, &quot;AA&quot;)); // æ‰“å°A
System.out.println(map.put(&quot;a&quot;, &quot;AB&quot;)); // æ‰“å°AA
</code></pre>

<p><strong>ï¼ˆ2ï¼‰getNodeæ–¹æ³•</strong></p>

<p>è¯´æ˜ï¼šHashMapåŒæ ·å¹¶æ²¡æœ‰ç›´æ¥æä¾›getNodeæ¥å£ç»™ç”¨æˆ·è°ƒç”¨ï¼Œè€Œæ˜¯æä¾›çš„getæ–¹æ³•ï¼Œè€Œgetæ–¹æ³•å°±æ˜¯é€šè¿‡getNodeæ¥å–å¾—å…ƒç´ çš„ã€‚</p>

<pre><code class="language-java">public V get(Object key) {
    Node e; return (e = getNode(hash(key), key)) == null ? null : e.value;
}
</code></pre>

<pre><code class="language-java">final Node getNode(int hash, Object key) {
    Node[] tab; Node first, e; int n; K k; // tableå·²ç»åˆå§‹åŒ–ï¼Œé•¿åº¦å¤§äº0ï¼Œæ ¹æ®hashå¯»æ‰¾tableä¸­çš„é¡¹ä¹Ÿä¸ä¸ºç©º
    if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) { // æ¡¶ä¸­ç¬¬ä¸€é¡¹(æ•°ç»„å…ƒç´ )ç›¸ç­‰
        if (first.hash == hash &amp;&amp; // always check first node
            ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; // æ¡¶ä¸­ä¸æ­¢ä¸€ä¸ªç»“ç‚¹
        if ((e = first.next) != null) { // ä¸ºçº¢é»‘æ ‘ç»“ç‚¹
            if (first instanceof TreeNode) // åœ¨çº¢é»‘æ ‘ä¸­æŸ¥æ‰¾
                return ((TreeNode)first).getTreeNode(hash, key); // å¦åˆ™ï¼Œåœ¨é“¾è¡¨ä¸­æŸ¥æ‰¾
            do { if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e;
            } while ((e = e.next) != null);
        }
    } return null;
}
</code></pre>

<p><strong>ï¼ˆ3ï¼‰resizeæ–¹æ³•</strong></p>

<p>â‘ .åœ¨jdk1.8ä¸­ï¼Œresizeæ–¹æ³•æ˜¯åœ¨hashmapä¸­çš„é”®å€¼å¯¹å¤§äºé˜€å€¼æ—¶æˆ–è€…åˆå§‹åŒ–æ—¶ï¼Œå°±è°ƒç”¨resizeæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼›</p>

<p>â‘¡.æ¯æ¬¡æ‰©å±•çš„æ—¶å€™ï¼Œéƒ½æ˜¯æ‰©å±•2å€ï¼›</p>

<p>â‘¢.æ‰©å±•åNodeå¯¹è±¡çš„ä½ç½®è¦ä¹ˆåœ¨åŸä½ç½®ï¼Œè¦ä¹ˆç§»åŠ¨åˆ°åŸåç§»é‡ä¸¤å€çš„ä½ç½®ã€‚</p>

<pre><code class="language-java">final Node[] resize() {
    Node[] oldTab = table;//oldTabæŒ‡å‘hashæ¡¶æ•°ç»„
    int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; int newCap, newThr = 0; if (oldCap &gt; 0) {//å¦‚æœoldCapä¸ä¸ºç©ºçš„è¯ï¼Œå°±æ˜¯hashæ¡¶æ•°ç»„ä¸ä¸ºç©º
        if (oldCap &gt;= MAXIMUM_CAPACITY) {//å¦‚æœå¤§äºæœ€å¤§å®¹é‡äº†ï¼Œå°±èµ‹å€¼ä¸ºæ•´æ•°æœ€å¤§çš„é˜€å€¼
            threshold = Integer.MAX_VALUE; return oldTab;//è¿”å›
        }//å¦‚æœå½“å‰hashæ¡¶æ•°ç»„çš„é•¿åº¦åœ¨æ‰©å®¹åä»ç„¶å°äºæœ€å¤§å®¹é‡ å¹¶ä¸”oldCapå¤§äºé»˜è®¤å€¼16
        else if ((newCap = oldCap oldCap &gt;= DEFAULT_INITIAL_CAPACITY)
            newThr = oldThr // double threshold åŒå€æ‰©å®¹é˜€å€¼threshold
 } else if (oldThr &gt; 0) // initial capacity was placed in threshold
        newCap = oldThr; else {               // zero initial threshold signifies using defaults
        newCap = DEFAULT_INITIAL_CAPACITY;
        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
    } if (newThr == 0) { float ft = (float)newCap * loadFactor;
        newThr = (newCap float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE);
    }
    threshold = newThr;
    @SuppressWarnings({&quot;rawtypes&quot;,&quot;unchecked&quot;})
        Node[] newTab = (Node[])new Node[newCap];//æ–°å»ºhashæ¡¶æ•°ç»„
    table = newTab;//å°†æ–°æ•°ç»„çš„å€¼å¤åˆ¶ç»™æ—§çš„hashæ¡¶æ•°ç»„
    if (oldTab != null) {//è¿›è¡Œæ‰©å®¹æ“ä½œï¼Œå¤åˆ¶Nodeå¯¹è±¡å€¼åˆ°æ–°çš„hashæ¡¶æ•°ç»„
        for (int j = 0; j j) {
            Node e; if ((e = oldTab[j]) != null) {//å¦‚æœæ—§çš„hashæ¡¶æ•°ç»„åœ¨jç»“ç‚¹å¤„ä¸ä¸ºç©ºï¼Œå¤åˆ¶ç»™e
                oldTab[j] = null;//å°†æ—§çš„hashæ¡¶æ•°ç»„åœ¨jç»“ç‚¹å¤„è®¾ç½®ä¸ºç©ºï¼Œæ–¹ä¾¿gc
                if (e.next == null)//å¦‚æœeåé¢æ²¡æœ‰Nodeç»“ç‚¹
                    newTab[e.hash &amp; (newCap - 1)] = e;//ç›´æ¥å¯¹eçš„hashå€¼å¯¹æ–°çš„æ•°ç»„é•¿åº¦æ±‚æ¨¡è·å¾—å­˜å‚¨ä½ç½®
                else if (e instanceof TreeNode)//å¦‚æœeæ˜¯çº¢é»‘æ ‘çš„ç±»å‹ï¼Œé‚£ä¹ˆæ·»åŠ åˆ°çº¢é»‘æ ‘ä¸­
                    ((TreeNode)e).split(this, newTab, j, oldCap); else { // preserve order
                    Node loHead = null, loTail = null;
                    Node hiHead = null, hiTail = null;
                    Node next; do {
                        next = e.next;//å°†Nodeç»“ç‚¹çš„nextèµ‹å€¼ç»™next
                        if ((e.hash &amp; oldCap) == 0) {//å¦‚æœç»“ç‚¹eçš„hashå€¼ä¸åŸhashæ¡¶æ•°ç»„çš„é•¿åº¦ä½œä¸è¿ç®—ä¸º0
                            if (loTail == null)//å¦‚æœloTailä¸ºnull
                                loHead = e;//å°†eç»“ç‚¹èµ‹å€¼ç»™loHead
                            else loTail.next = e;//å¦åˆ™å°†eèµ‹å€¼ç»™loTail.next
                            loTail = e;//ç„¶åå°†eå¤åˆ¶ç»™loTail
 } else {//å¦‚æœç»“ç‚¹eçš„hashå€¼ä¸åŸhashæ¡¶æ•°ç»„çš„é•¿åº¦ä½œä¸è¿ç®—ä¸ä¸º0
                            if (hiTail == null)//å¦‚æœhiTailä¸ºnull
                                hiHead = e;//å°†eèµ‹å€¼ç»™hiHead
                            else hiTail.next = e;//å¦‚æœhiTailä¸ä¸ºç©ºï¼Œå°†eå¤åˆ¶ç»™hiTail.next
                            hiTail = e;//å°†eå¤åˆ¶ä¸ªhiTail
 }
                    } while ((e = next) != null);//ç›´åˆ°eä¸ºç©º
                    if (loTail != null) {//å¦‚æœloTailä¸ä¸ºç©º
                        loTail.next = null;//å°†loTail.nextè®¾ç½®ä¸ºç©º
                        newTab[j] = loHead;//å°†loHeadèµ‹å€¼ç»™æ–°çš„hashæ¡¶æ•°ç»„[j]å¤„
 } if (hiTail != null) {//å¦‚æœhiTailä¸ä¸ºç©º
                        hiTail.next = null;//å°†hiTail.nextèµ‹å€¼ä¸ºç©º
                        newTab[j + oldCap] = hiHead;//å°†hiHeadèµ‹å€¼ç»™æ–°çš„hashæ¡¶æ•°ç»„[j+æ—§hashæ¡¶æ•°ç»„é•¿åº¦]
 }
                }
            }
        }
    } return newTab;
}
</code></pre>

<ul>
<li>
<a href="#toc_0">æ¦‚è¿°</a>
</li>
<li>
<a href="#toc_1">æ¶‰åŠåˆ°çš„æ•°æ®ç»“æ„ï¼šå¤„ç†hashå†²çªçš„é“¾è¡¨å’Œçº¢é»‘æ ‘ä»¥åŠä½æ¡¶</a>
<ul>
<li>
<a href="#toc_2">é“¾è¡¨çš„å®ç°</a>
</li>
<li>
<a href="#toc_3">çº¢é»‘æ ‘</a>
</li>
<li>
<a href="#toc_4">ä½æ¡¶</a>
</li>
</ul>
</li>
<li>
<a href="#toc_5">HashMapæºç åˆ†æ</a>
<ul>
<li>
<a href="#toc_6">ç±»çš„ç»§æ‰¿å…³ç³»</a>
</li>
<li>
<a href="#toc_7">ç±»çš„å±æ€§</a>
</li>
<li>
<a href="#toc_8">ç±»çš„æ„é€ å‡½æ•°</a>
<ul>
<li>
<a href="#toc_9">HashMap(int, float)å‹æ„é€ å‡½æ•°</a>
</li>
<li>
<a href="#toc_10">HashMap(int)å‹æ„é€ å‡½æ•°</a>
</li>
<li>
<a href="#toc_11">HashMap()å‹æ„é€ å‡½æ•°</a>
</li>
<li>
<a href="#toc_12">HashMap(Map)å‹æ„é€ å‡½æ•°</a>
</li>
</ul>
</li>
<li>
<a href="#toc_13">hashç®—æ³•</a>
</li>
<li>
<a href="#toc_14">é‡è¦æ–¹æ³•åˆ†æ</a>
<ul>
<li>
<ul>
<li>
<a href="#toc_15">HashMapçš„æ•°æ®å­˜å‚¨å®ç°åŸç†</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/2/27 16:27 ä¸‹åˆ</span>
                    <span>å‘å¸ƒäºåˆ†ç±»&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='java.html'>åç«¯</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15511460518747.html">
                
                  <h1>JavaåŸºç¡€çŸ¥è¯†æ•´ç†</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<ul>
<li>ä¸ç§¯è·¬æ­¥æ— ä»¥è‡³åƒé‡Œï¼Œä¸ç§¯å°æµæ— ä»¥æˆæ±Ÿæµ·</li>
<li>åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹</li>
</ul>


                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                   <a href="15511460518747.html">é˜…è¯»æ›´å¤š&gt;&gt;</a>&nbsp;&nbsp; 
                    <span class="date">2019/2/26 9:54 ä¸Šåˆ</span>
                    <span>å‘å¸ƒäºåˆ†ç±»&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='java.html'>åç«¯</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15511042581022.html">
                
                  <h1>å¾®æœåŠ¡æ¶æ„ä¸‹å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„å…¸å‹æ–¹æ¡ˆ</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>æ ¹æ®å¾®æœåŠ¡æ¶æ„çš„é¼»ç¥–Martin Fowlerçš„å¿ å‘Šï¼Œå¾®æœåŠ¡æ¶æ„ä¸­åº”å½“å°½é‡é¿å…åˆ†å¸ƒå¼äº‹åŠ¡ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›é¢†åŸŸï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å¦‚åŒå®¿å‘½ä¸­çš„å¯¹æ‰‹æ— æ³•é¿å…ã€‚åœ¨å·¥ç¨‹é¢†åŸŸï¼Œåˆ†å¸ƒå¼äº‹åŠ¡çš„è®¨è®ºä¸»è¦èšç„¦äºå¼ºä¸€è‡´æ€§å’Œæœ€ç»ˆä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆã€‚å…¸å‹æ–¹æ¡ˆåŒ…æ‹¬ï¼š<br/>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                   <a href="15511042581022.html">é˜…è¯»æ›´å¤š&gt;&gt;</a>&nbsp;&nbsp; 
                    <span class="date">2019/2/25 22:17 ä¸‹åˆ</span>
                    <span>å‘å¸ƒäºåˆ†ç±»&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='microservice.html'>å¾®æœåŠ¡</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15511041776834.html">
                
                  <h1>åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸è§çš„äº‹åŠ¡å¤„ç†æœºåˆ¶</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>ä¸ºä¿éšœç³»ç»Ÿçš„å¯ç”¨æ€§ã€å¯é æ€§ä»¥åŠæ€§èƒ½ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾€å¾€ä¼šè®¾ç½®æ•°æ®å†—ä½™ï¼Œå³å¯¹æ•°æ®è¿›è¡Œå¤åˆ¶ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå½“ä¸€ä¸ªæ•°æ®åº“çš„å‰¯æœ¬è¢«ç ´ç¯ä»¥åï¼Œé‚£ä¹ˆç³»ç»Ÿåªéœ€è¦è½¬æ¢åˆ°å…¶ä»–æ•°æ®å‰¯æœ¬å°±èƒ½ç»§ç»­è¿è¡Œä¸‹å»ã€‚<br/>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                   <a href="15511041776834.html">é˜…è¯»æ›´å¤š&gt;&gt;</a>&nbsp;&nbsp; 
                    <span class="date">2019/2/25 22:16 ä¸‹åˆ</span>
                    <span>å‘å¸ƒäºåˆ†ç±»&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='microservice.html'>å¾®æœåŠ¡</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15511034481464.html">
                
                  <h1>ğŸ˜‹ æŠ€æœ¯å¿…å¤‡åŸºç¡€çŸ¥è¯†</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<p>æœ¬é¡¹ç›®åŒ…å«äº†æŠ€æœ¯é¢è¯•å¿…å¤‡çš„åŸºç¡€çŸ¥è¯†ï¼Œæµ…æ˜¾æ˜“æ‡‚ï¼Œä½ ä¸éœ€è¦èŠ±å¾ˆé•¿çš„æ—¶é—´å»é˜…è¯»å’Œç†è§£æˆå †çš„æŠ€æœ¯ä¹¦ç±å°±å¯ä»¥å¿«é€ŸæŒæ¡è¿™äº›çŸ¥è¯†ï¼Œä»è€ŒèŠ‚çœå®è´µçš„é¢è¯•å¤ä¹ æ—¶é—´ã€‚ä½ ä¹Ÿå¯ä»¥é˜…è¯»Â <a href="https://github.com/CyC2018/Backend-Interview-Guide">é¢è¯•è¿›é˜¶æŒ‡å—</a>ï¼ŒåŒ…å«äº†å­¦ä¹ æŒ‡å¯¼å’Œé¢è¯•æŠ€å·§ï¼Œè®©ä½ æ›´è½»æ¾æ‹¿åˆ°æ»¡æ„çš„ Offerã€‚<br/>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                   <a href="15511034481464.html">é˜…è¯»æ›´å¤š&gt;&gt;</a>&nbsp;&nbsp; 
                    <span class="date">2019/2/25 22:4 ä¸‹åˆ</span>
                    
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			 <a href="all_1.html">&raquo; ä¸‹ä¸€é¡µ</a> 
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="http://image.sangkf.cn/IMG_0186.jpg" /></div>
            
                <h1>è§è¯¾å°±ä¸Šçš„å°å©Šç ¸</h1>
                <div class="site-des">äººç”Ÿçš„ç£¨éš¾æ˜¯å¾ˆå¤šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¯å¯¹äºæ¯ä¸€ä»¶è½»å¾®çš„ä¼¤å®³éƒ½è¿‡äºæ•æ„Ÿã€‚åœ¨ç”Ÿæ´»ç£¨éš¾é¢å‰ï¼Œç²¾ç¥ä¸Šçš„åšå¼ºå’Œæ— åŠ¨äºè¡·æ˜¯æˆ‘ä»¬æŠµæŠ—ç½ªæ¶å’Œäººç”Ÿæ„å¤–çš„æœ€å¥½æ­¦å™¨ã€‚</div>
                <div class="social">









<a target="_blank" class="github" target="_blank" href="https://github.com/sangskf" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:413198756@qq.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>æ–‡ç« åˆ†ç±»</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="front.html"><strong>å‰ç«¯</strong></a>
        
            <a href="java.html"><strong>åç«¯</strong></a>
        
            <a href="microservice.html"><strong>å¾®æœåŠ¡</strong></a>
        
            <a href="database.html"><strong>æ•°æ®åº“</strong></a>
        
            <a href="other.html"><strong>å…¶ä»–</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>æœ€æ–°å‘å¸ƒ</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15512563500691.html">HashMapæºç è§£è¯»(JDK1.7)</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15512560778974.html">HashMapæºç è§£è¯»(JDK1.8)</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15511460518747.html">JavaåŸºç¡€çŸ¥è¯†æ•´ç†</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15511042581022.html">å¾®æœåŠ¡æ¶æ„ä¸‹å¤„ç†åˆ†å¸ƒå¼äº‹åŠ¡çš„å…¸å‹æ–¹æ¡ˆ</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15511041776834.html">åˆ†å¸ƒå¼ç³»ç»Ÿå¸¸è§çš„äº‹åŠ¡å¤„ç†æœºåˆ¶</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2019
Powered by <a target="_blank" href="http://books.sangkf.cn">è§è¯¾å°±ä¸Šçš„å°å©Šç ¸</a>,&nbsp; 
 &nbsp;äº¬ICPå¤‡18064309å·
 <img width="13" height="16" src="https://ss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/img/copy_rignt_24.png">
</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    

<style type="text/css">
	#custom_menu{
		float: left;width: 200px;
		position:absolute;
		z-index: 999;
		margin-top: 65px;
	}
	#custom_menu li{
	   list-style: none;
	   margin: 0px;
	   padding: 0px;
	}
	#custom_menu ul li{
		border-bottom: : 1px solid #ccc;
	}
	#custom_menu ul li a{
		display: block;
		text-decoration: none;
		padding: 6px 10px;
		background-color: white;
		border-left: 2px solid #ccc;
	}
	#custom_menu ul li a:hover{
		background-color: #f7f7f7;
	}
</style>
<script>
	function browserRedirect() {
      var sUserAgent = navigator.userAgent.toLowerCase();
      var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
      var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
      var bIsMidp = sUserAgent.match(/midp/i) == "midp";
      var bIsUc7 = sUserAgent.match(/rv:1.2.3.4/i) == "rv:1.2.3.4";
      var bIsUc = sUserAgent.match(/ucweb/i) == "ucweb";
      var bIsAndroid = sUserAgent.match(/android/i) == "android";
      var bIsCE = sUserAgent.match(/windows ce/i) == "windows ce";
      var bIsWM = sUserAgent.match(/windows mobile/i) == "windows mobile";
      if (bIsIpad || bIsIphoneOs || bIsMidp || bIsUc7 || bIsUc || bIsAndroid || bIsCE || bIsWM) {
        return true;
      } else {
        return false;
      }
    }

	$(document).ready(function(){
		if(!browserRedirect()){
		$(".article-content>ul:last").wrap("<div id='custom_menu'></div>");
	    	var $custom_menu = $("#custom_menu");
	    	$("#custom_menu").remove();
	    	$custom_menu.insertBefore($(".inner-wrap"));
	    	var menuYloc = $("#custom_menu").offset().top;
			$(window).scroll(function () {
				var offsetTop = menuYloc + $(window).scrollTop() + "px";
				$("#custom_menu").css("margin-top",offsetTop);
			});
		}
	});
</script> 

  </body>
</html>
